#!/usr/bin/env python
# encoding: utf8

import os, os.path

def build(bld):

    import Utils
    env = bld.env
    sub = Utils.subst_vars
        
    # generade src files from IDL - must be run before compilation
    src_dir =os.getcwd()
    editor_dir = os.path.join(src_dir, 'src', 'editor')
        
    cmd = sub('${ORBIT_IDL} --output-dir=%s -I%s ${BONOBO_IDL_INCLUDES} -I${GTKHTML_DATA}/gtkhtml ${GTKHTML_DATA}/Editor.idl'
            % (editor_dir, src_dir), env)

    idl = bld.new_task_gen(rule=cmd)
    idl.before = 'cc cxx' # generate before compilation C/C++


    lib = bld.new_task_gen(
        features='cc', # use C compiler - less restrictive than C++
        includes='. ../../ ../../src ../../src/editor %s' % bld.env['GECKO_INCLUDE'], # ../../ for config.h
        target='editor',
        uselib='GTK GLIB GNOMEUI SWORD GTKMOZEMBED GTKHTML',
        #uselib_local='backend gecko',
    )

    lib.find_sources_in_dirs('.')

